<!DOCTYPE html>
<html>

<head>


    <!-- BEGIN TIKTOK BASE CODE -->
    <script>
        !function (w, d, t) {
            w.TiktokAnalyticsObject = t; var ttq = w[t] = w[t] || []; ttq.methods = ["page", "track", "identify", "instances", "debug", "on", "off", "once", "ready", "alias", "group", "enableCookie", "disableCookie"], ttq.setAndDefer = function (t, e) { t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }; for (var i = 0; i < ttq.methods.length; i++)ttq.setAndDefer(ttq, ttq.methods[i]); ttq.instance = function (t) {
                for (var e = ttq._i[t] || [], n = 0; n < ttq.methods.length; n++
                )ttq.setAndDefer(e, ttq.methods[n]); return e
            }, ttq.load = function (e, n) { var i = "https://analytics.tiktok.com/i18n/pixel/events.js"; ttq._i = ttq._i || {}, ttq._i[e] = [], ttq._i[e]._u = i, ttq._t = ttq._t || {}, ttq._t[e] = +new Date, ttq._o = ttq._o || {}, ttq._o[e] = n || {}; n = document.createElement("script"); n.type = "text/javascript", n.async = !0, n.src = i + "?sdkid=" + e + "&lib=" + t; e = document.getElementsByTagName("script")[0]; e.parentNode.insertBefore(n, e) };

            ttq.load('CNEVBARC77UFT37T124G');
            ttq.page();
        }(window, document, 'ttq');
    </script>
    <!-- END TIKTOK BASE CODE -->

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        // gtag('config', 'UA-XXXXX-Y');
    </script>

    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-KSFZJGJG');</script>
    <!-- End Google Tag Manager -->

    <title>Hello World | Store</title>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KSFZJGJG" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="content">
        <header>
            <h1 class="title">Hello World | Store</h1>
            <div class="cart">
                Items In Cart:<input type="number" id="cart-items" width="10" height="10" value="0">
            </div>
        </header>

        <container>
            <div>
                Logged in as email@example.com
            </div>
        </container>

        <table>
            <tr>
                <td>
                    <div class="container">
                        <div class="box" data-item="1">
                            <div class="item-title-1">Product 1</div>
                            <div class="item-product-id-1">Product ID: 5678AB</div>
                            <div class="item-price-1">$29.99</div>
                            <!-- Add input element for quantity -->
                            <input type="number" class="item-quantity-1" value="1" style="display: none;">
                            <button onclick="viewContent('Product 1','5678AB',29.99)">View Content Details</button>
                            <button id="add-to-cart-button-1" onclick="addToCart('Product 1','5678AB',29.99)">Add To
                                Cart</button>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="container">
                        <div class="box" data-item="2">
                            <div class="item-title-2">Product 2</div>
                            <div class="item-product-id-2">Product ID: 6521FJ</div>
                            <div class="item-price-2">$49.99</div>
                            <!-- Add input element for quantity -->
                            <input type="number" class="item-quantity-2" value="1" style="display: none;">
                            <button onclick="viewContent('Product 2','6521FJ',49.99)">View Content Details</button>
                            <button id="add-to-cart-button-2" onclick="addToCart('Product 2','6521FJ',49.99)">Add To
                                Cart</button>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="container">
                        <div class="box" data-item="3">
                            <div class="item-title-3" class="shop-item-title">Product 3</div>
                            <div class="item-product-id-3">Product ID: 4098MD</div>
                            <div class="item-price-3" class="shop-item-price">$199.99</div>
                            <!-- Add input element for quantity -->
                            <input type="number" class="item-quantity-3" value="1" style="display: none;">
                            <button onclick="viewContent('Product 3','4098MD',199.99)">View Content Details</button>
                            <button id="add-to-cart-button-3" onclick="addToCart('Product 3','4098MD',199.99)">Add To
                                Cart</button>
                        </div>
                    </div>
                </td>
            </tr>
        </table>


        <button class="checkout" onclick="initiateCheckout()">Initiate Checkout</button>

        <footer>

        </footer>

    </div>

    <!-- BEGIN TIKTOK PIXEL EVENT FUNCTIONS SCRIPT SECTION -->
    <script>
        // BEGIN DO NOT EDIT SECTION 
        completeRegistration();
        // END DO NOT EDIT SECTION 

        function completeRegistration() {
            // BEGIN DO NOT EDIT SECTION 
            console.log("completeRegistration Function")

            alert("Required Registration Step - click OK to continue" +
                "\n" + "Email address provided is email@example.com");

            alert("Required Registration Step - click OK to continue" +
                "\n" + "Phone number provided +15551234567");

            alert("Registration Complete - Logged in as email@example.com");

            var phone = "+15551234567";
            var email = "email@example.com";

            console.log("email: " + email);
            console.log("phone: " + phone);
            // END DO NOT EDIT SECTION 

            // BEGIN - PLACE YOUR FUNCTIONS IN THIS SECTION 

            ttq.identify({
                // ADVANCED MATCHING PARAMETERS 
                email: email,
                phone_number: phone
            })

            ttq.track("CompleteRegistration", {
                // EVENT PARAMETERS 
                email: email,
                phone_number: phone

            })

            //END - PLACE YOUR FUNCTIONS IN THIS SECTION 
            // Push email, phone number, and event to dataLayer
            gtag('event', 'registration', {
                'email': email,
                'phone_number': phone
            });
        }

        function viewContent(title, productId, price) {
            // BEGIN DO NOT EDIT SECTION 
            alert("Mock Product Item Details Popup: "
                + "\n" + "title: " + title
                + "\n" + "price: " + price
                + "\n" + "productId: " + productId)
            // END DO NOT EDIT SECTION 

            // BEGIN HINT: UTILIZE THESE VARIABLES WHEN CONSTRUCTING YOUR CORRESPONDING TIKTOK PIXEL EVENT
            console.log("viewContent Function")
            console.log("title:" + " " + title);
            console.log("price:" + " " + price);
            console.log("productId:" + " " + productId);
            // END HINT: UTILIZE THESE VARIABLES WHEN CONSTRUCTING YOUR CORRESPONDING TIKTOK PIXEL EVENT

            // BEGIN - PLACE YOUR FUNCTIONS IN THIS SECTION 

            ttq.identify({
                /* ADVANCED MATCHING PARAMETERS */
                email: 'email@example.com',
                phone_number: '+15551234567'
            })

            ttq.track("ViewContent", {
                /* EVENT PARAMETERS */
                content_name: title,
                content_id: productId,
                value: price,
                currency: 'USD'
            })

            // END - PLACE YOUR FUNCTIONS IN THIS SECTION 

            gtag('event', 'view_item', {
                'items': [{
                    'item_name': title,
                    'item_id': productId,
                    'price': price,
                    'currency': 'USD',
                    'quantity': 1
                }]
            });
        }

        function addToCart(title, productId, price) {
            // BEGIN HINT: UTILIZE THESE VARIABLES WHEN CONSTRUCTING YOUR CORRESPONDING TIKTOK PIXEL EVENTS 
            console.log("addToCart Function")
            console.log("title:" + " " + title);
            console.log("price:" + " " + price);
            console.log("productId:" + " " + productId);
            // END HINT: UTILIZE THESE VARIABLES WHEN CONSTRUCTING YOUR CORRESPONDING TIKTOK PIXEL EVENTS 

            // BEGIN DO NOT EDIT SECTION 
            if (title == "Product 1") {
                document.getElementById("add-to-cart-button-1").disabled = 'true';
            } else if (title == "Product 2") {
                document.getElementById("add-to-cart-button-2").disabled = 'true';
            } else if (title == "Product 3") {
                document.getElementById("add-to-cart-button-3").disabled = 'true';
            }
            document.getElementById("cart-items").stepUp();
            // END DO NOT EDIT SECTION 

            // BEGIN - PLACE YOUR FUNCTIONS IN THIS SECTION 

            ttq.identify({
                // ADVANCED MATCHING PARAMETERS
                email: 'email@example.com',
                phone_number: '+15551234567'
            })

            ttq.track("AddToCart", {
                // EVENT PARAMETERS 
                content_name: title,
                content_id: productId,
                value: price,
                currency: 'USD'
            })

            // END - PLACE YOUR FUNCTIONS IN THIS SECTION    

            gtag('event', 'add_to_cart', {
                'items': [{
                    'item_name': title,
                    'item_id': productId,
                    'price': price,
                    'currency': 'USD',
                    'quantity': 1
                }]
            });
        }

        function initiateCheckout() {
            var retVal = confirm("This is a pop up meant to be a mock initiate checkout step - clicking OK will assume that the correct payment information was entered by the customer. Purchase will then complete successfully. HINT: Clicking Cancel should not trigger any events");

            if (retVal == true) {
                // BEGIN - PLACE YOUR FUNCTIONS IN THIS SECTION 

                ttq.identify({
                    // ADVANCED MATCHING PARAMETERS 
                    email: 'email@example.com',
                    phone_number: '+15551234567'
                })

                // Retrieve cart items from the UI
                var cartItems = document.querySelectorAll('.container .box');
                var contents = [];

                // Iterate over each cart item to extract details
                cartItems.forEach(function (item) {
                    var itemName = item.querySelector('.item-title-' + item.dataset.item).innerText;
                    var itemProductId = item.querySelector('.item-product-id-' + item.dataset.item).innerText;
                    var itemPrice = parseFloat(item.querySelector('.item-price-' + item.dataset.item).innerText.replace('$', ''));
                    var itemQuantity = parseInt(item.querySelector('.item-quantity-' + item.dataset.item).value);

                    // Add item to contents array
                    contents.push({
                        content_name: itemName,
                        content_id: itemProductId,
                        quantity: itemQuantity,
                        price: itemPrice,
                        currency: 'USD'
                    });
                });

                // Calculate total value of items in cart
                var totalValue = contents.reduce(function (total, item) {
                    return total + (item.price * item.quantity);
                }, 0);

                // Send GA4 event
                gtag('event', 'begin_checkout', {
                    'items': contents,
                    'currency': 'USD',
                    'value': totalValue
                });

                // END - PLACE YOUR FUNCTIONS IN THIS SECTION 

                // BEGIN DO NOT EDIT SECTION 
                completePayment();
            } else {
                alert("Payment step cancelled!");
                return false;
            }
            // END DO NOT EDIT SECTION 
        }

        function completePayment() {
            // BEGIN - PLACE YOUR FUNCTIONS IN THIS SECTION 

            ttq.identify({
                // ADVANCED MATCHING PARAMETERS 
                email: 'email@example.com',
                phone_number: '+15551234567'
            })

            // Get the cart items from the UI
            var cartItems = document.querySelectorAll('.container .box');
            var contents = [];

            // Iterate over each cart item to extract relevant data
            cartItems.forEach(function (item) {
                var itemName = item.querySelector('.item-title-' + item.dataset.item).innerText;
                var itemProductId = item.querySelector('.item-product-id-' + item.dataset.item).innerText;
                var itemPrice = parseFloat(item.querySelector('.item-price-' + item.dataset.item).innerText.replace('$', ''));
                var itemQuantity = parseInt(item.querySelector('.item-quantity-' + item.dataset.item).value);

                // Add the item to the contents array
                contents.push({
                    content_name: itemName,
                    content_id: itemProductId,
                    quantity: itemQuantity,
                    price: itemPrice,
                    currency: 'USD'
                });
            });

            // Calculate total value of items in the cart
            var totalValue = contents.reduce(function (total, item) {
                return total + (item.price * item.quantity);
            }, 0);

            // Send TikTok Pixel event
            ttq.track('CompletePayment', {
                contents: contents,
                content_type: 'product',
                value: totalValue,
                currency: 'USD',
                quantity: contents.length,
                content_name: 'Products'
            });

            // Push email, phone number, and event to GA4 data layer using gtag
            gtag('event', 'complete_payment', {
                'email': 'email@example.com',
                'phone_number': '+15551234567',
                'total_value': totalValue,
                'items': contents.map(function (item) {
                    return {
                        'item_name': item.content_name,
                        'item_id': item.content_id,
                        'quantity': item.quantity,
                        'price': item.price
                    };
                })
            });

            // END - PLACE YOUR FUNCTIONS IN THIS SECTION 	

            // BEGIN DO NOT EDIT SECTION 
            alert("Payment Completed - Purchase Successful")
            // END DO NOT EDIT SECTION 
        }



    </script>
    <!-- END TIKTOK PIXEL EVENT FUNCTIONS SCRIPT SECTION -->

    <!-- BEGIN STYLING SECTION - DO NOT EDIT -->
    <style type="text/css">
        h1+div {
            padding-left: 370px;
        }

        div {
            padding: 10px;
        }

        table {
            padding-bottom: 20px;
        }

        footer {
            padding: 10px;
        }

        .box {
            box-sizing: content-box;
            width: 200px;
            height: 180px;
            padding: 20px;
            border: 2px solid black;
            text-align: center;
        }

        .cart {
            float: right;
        }

        .content {
            max-width: 800px;
            margin: auto;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            display: inline-block;
        }

        #cart-items {
            border: 0;
        }
    </style>
    <!-- END STYLING SECTION - DO NOT EDIT -->

</body>

</html>